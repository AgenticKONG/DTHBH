# 數字黃賓虹 (Digital Huang Binhong) 項目憲章

本文檔包含三部分：
（一）交互開發規約（RULES），規約在允許下新增或修改，Agents沒有刪除權限；
（二）項目約定，在規約框架下，記錄本項目的約定，約定的編輯必須在允許下進行；
（三）項目備忘錄，在規約和約定的框架下，記錄項目過程中臨時性的“TODO LIST”、“設計想法”、“不確定問題”等等。

---

## （一）交互開發規約 (RULES)

1.  **數據「防衝刷」機制 (Data Protection Protocol)**：自動提取與人工補錄必須物理分離。所有非來源 CSV 的補充數據（如身後回響、細節補遺）必須存放於獨立的 `Supplement.json` 中。在更新生產數據前，必須進行緩衝校驗，比對關鍵節點是否依然存在且內容完整。
2.  **多實體「座標死鎖」原則 (Entity Anchor Lock)**：所有動態交互路徑（如雙線並行、磁吸）必須共享同一個 X 軸錨點隊列。任何一個實體在 X 座標上的位移，必須強制在該 X 座標為其他所有關聯實體提供 Y 軸對應點。座標點的 `push` 操作必須成組執行，嚴禁數量不對等。
3.  **「史實優先於算法」準則 (Facts Over Heuristics)**：算法僅能用於「填補數據空白」，不能「篡改既成事實」。若數據源 JSON 中已存在特定字段（如人工校準過的 `topic` 或 `details`），前端邏輯必須無條件優先呈現，嚴禁使用 Runtime 的關鍵詞匹配進行二次覆蓋。
4.  **全局樣式「受保護代碼塊」 (Protected Style Audit)**：組件重構不應觸及視覺基座。`.custom-scrollbar`、主題色定義、佈局邊界、導航組件等必須作為受保護代碼。全量重寫組件後，必須進行樣式清單對標檢查。
5.  **動態邊界「相對化」計算 (Viewport Boundary Relativity)**：嚴禁使用與視口無關的物理像素常量（Magic Numbers）。所有視覺峰值、位移、卡片尺寸計算必須基於 `containerHeight`、`margin` 或 `centerY` 進行相對百分比計算，確保在不同分辨率下不破壞佈局完整性。
7.  **「斷點保存機制」(Breakpoint Preservation)**：為應對終端異常重啟，每完成一個子任務或會話結束前，必須在 MEMO 部分更新當前“斷點”狀態。狀態應包含：最後執行的腳本、最後修改的文件、下一步具體操作。此機制用於確保上下文能無縫銜接。
8.  **「原子化 Git 提交」(Atomic Commits)**：為確保開發進度的物理可追溯性，每完成 TODO LIST 中的一個子任務，必須進行一次 Git 提交。提交信息格式應包含任務編號（如 `[GEMINI-SYNC] 完成 DATA-01`）。這是在「斷點保存機制」基礎上的物理層保障。
9. 	**如果对AGREEMNTS有疑问和建议，需要及时反馈，协助人工更新。如果对MEMOS有疑问（如任务或者TODO LIST看不明白或者状态已变化等等），及时更新和反馈，并通过终端告知人工。**
---


## （二）項目約定 (PROJECT AGREEMENTS)

### 1. 先计划后执行，严格TODO LIST机制
*   **TOOD LIST**：通过终端或者本文档接受任务指派时，先分解任务，形成TODO LIST，写入本文档的MEMO。如果人工在线，先与人工确认。
*   **及时更新**：工作中及时更新TODO LIST，并及时反馈到终端和本文档。，
*   **状态机制**：“完成”在[]打✅；“有问题未开始或者已开始不顺利”在[] 打❌并任务后说明疑问；“任务变更”删除线，在下方新建任务。


### 2. Git 協作與提交規範
*   **提交身份**：必須使用 `H2EricK` (Gemini CLI) 或 `AgenticKONG` (MiniMax) 身份。
*   **路徑過濾**：嚴禁將 `.py` 處理腳本、`.bak` 備份文件、`.pem` 證書、臨時數據緩衝文件推送到遠程倉庫。必須嚴格執行 `.gitignore`。
*   **強制同步**：推送到 GitHub 前，必須執行 `git pull --rebase origin main` 確保歷史線性。
*   **提交提醒**：在交互编程时，合理提醒人工及时提交GIT备份。

### 3. 臨時資源與數據處理
*   **腳本歸屬**：执行脚本都存放在`DTHBH/scripts/` 下，Python 工具僅限於本地環境生成數據使用，不進入代碼版本庫。
*   **腳本執行日誌 (Execution Logs)**：大規模數據處理腳本（抽取、轉換、清洗）必須在 `DTHBH/scripts/logs/` 下生成同名的 `.log.json` 緩衝文件。日誌需記錄：最後處理的 ID/行號、成功/失敗統計。此日誌用於異常中斷後的“斷點續傳”，不進入代碼版本庫。
*   **數據更新流程**：更新生產JSON或CSV前，需先輸出至緩衝文件，由 `scripts/CompareData.py` 進行一致性檢查後方可覆蓋。
*   **临时數據处理**：临时数据JSON or CSV都存放在‘DTHBH/data/’下，不进入代码版本库。
*	**临时文件处理**：设计思路等文档（.md/）都存在‘DTHBH/docs/’下，是否进入代码版本库，请在产生或者变更后询问人工决定。


### 4. 本地開發環境約定
| 項目 | 約定值 | 說明 |
|------|--------|------|
| PostgreSQL 端口 | **5433** | 若本機使用 5432，請在 `.env` 修改 |
| 數據庫名稱 | `huangbinhong_visualization` | |
| Redis 端口 | 6379 | 無密碼模式 |
| 後端服務端口 | 8081 | |
| 前端 dev 端口 | 3000 | `npm run serve` |
| 靜態資源端口 | 8082 | 用於本地數據文件訪問測試 |

### 5. 設計快照機制 (Design Snapshot)
*   **觸發條件**：面對複雜架構重構或邏輯設計時，Agent 可主動觸發或由人工提示執行。
*   **輸出內容**：在 `DTHBH/docs/snapshots/` 下生成 Markdown 文件，記錄具體實現方案、潛在風險、未竟思路。
*   **路徑過濾**：此目錄下的所有文件不進入代碼版本庫，需在 `.gitignore` 中明確排除。

---

## （三）項目備忘錄 (MEMO)

### 1. 任务（任务放置处，不要删除！按顺序人工新增，每天1条，描述清晰，【DONE】表示完成）
*  [T20260228] PULL和阅读GIT上“/docs/生平大河时间轴设计思路.md”，优化设计思路，分解任务形成TODO LIST。 【IN PROGRESS】
*  [T20260227] 优化“知音长线”	的设计与开发工作。【DONE】


### 2. TODO LIST
#### [T20260228] 生平大河時間軸優化 (Digital Life River)
##### 數據解析與主題打標 (Data & Theming)
- [ ] **[DATA-01]** 增強 `assignThemes` 邏輯：引入更精細的關鍵詞（如：變法、黑密厚重、簡筆、題跋、鑒藏等）。
- [ ] **[DATA-02]** 實現“防衝刷”補錄：在 `chronology.js` 中接入 `Supplement.json`，支持對特定 ID 事件進行人工主題覆蓋。
- [ ] **[DATA-03]** 聚合算法優化：優化 `YearBucket` 的高度計算，確保大河曲線在不同時間段的起伏感，避免極端數據破壞佈局。

##### 大河圖交互與視覺 (RiverChart UI/UX)
- [ ] **[UX-01]** 實現橫向滾輪滾動：復用 `TimelinePage` 的 `wheel` 處理邏輯，支持在 1864-1955 間平滑平移。
- [ ] **[UX-02]** 增加 Hover Tooltip：實時顯示該年份的事件密度分佈預覽。
- [ ] **[VISUAL-01]** 強化水墨視覺：選中單一主題時，背景大河變為“淺墨色”，高亮主題路徑應用濃墨效果。
- [ ] **[VISUAL-02]** 時代背景層美化：將時代底色（晚清/民國/新中國）改為更具古籍質感的色塊或書法字體。

##### 年份詳情面板優化 (YearDetailPanel)
- [ ] **[UX-03]** “研讀模式”交互增強：點擊卡片平滑展開 `Details_Evidence` 的完整史料引文。
- [ ] **[VISUAL-03]** 卡片樣式微調：對齊“蜀游長卷”風格，增加紙張紋理和印章隨機旋轉角度。

##### 全局聯動與導航 (Integration)
- [ ] **[NAV-01]** 在 `FriendsNetwork.vue` 標籤欄中正式加入“生平大河”入口，確保路由跳轉狀態保留。
- [ ] **[NAV-02]** 狀態同步：點擊大河年份時，聯動更新全局 `selectedYear`。

### 3. 突然有个想法（想法放置处，不要删除！按顺序新增，描述清晰，【DONE】表示关闭）
*  

### 4. 啊呀，碰到一个问题（问题放置处，不要删除！按顺序新增，描述清晰，【DONE】表示关闭）
*  
