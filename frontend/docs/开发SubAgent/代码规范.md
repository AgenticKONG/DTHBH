# 黄宾虹数字艺术展3D展厅 - 代码规范

## 版本
- 版本号: v1.0
- 创建日期: 2026-02-23
- 适用范围: 黄宾虹数字艺术展3D展厅项目

---

## 一、命名规范

### 1.1 文件命名规范

#### Vue组件文件
- **规则**: PascalCase（大驼峰）
- **示例**:
  ```
  ✅ ThreeDExhibition.vue
  ✅ LoadingOverlay.vue
  ✅ NavigationToolbar.vue
  ❌ three-d-exhibition.vue
  ❌ loading_overlay.vue
  ```

#### JavaScript/TypeScript文件
- **规则**: camelCase（小驼峰）
- **示例**:
  ```
  ✅ sceneManager.js
  ✅ paintingFrame.js
  ✅ materialLoader.js
  ❌ SceneManager.js
  ❌ material-loader.js
  ```

#### CSS/SCSS文件
- **规则**: kebab-case（短横线）
- **示例**:
  ```
  ✅ exhibition-styles.css
  ✅ navigation-toolbar.scss
  ❌ exhibitionStyles.css
  ❌ navigation_toolbar.scss
  ```

#### 配置文件
- **规则**: camelCase
- **示例**:
  ```
  ✅ exhibitionHalls.js
  ✅ materialConfig.js
  ❌ exhibition_halls.js
  ```

#### 测试文件
- **规则**: [组件名].spec.js 或 [组件名].test.js
- **示例**:
  ```
  ✅ sceneManager.spec.js
  ✅ materialLoader.test.js
  ❌ scene_manager_test.js
  ```

### 1.2 变量命名规范

#### 变量名
- **规则**: camelCase
- **示例**:
  ```javascript
  ✅ const currentHallId = 'early';
  ✅ let paintingPosition = { x: 0, y: 0, z: 0 };
  ✅ const isLoaded = false;
  ❌ const current_hall_id = 'early';
  ❌ const PaintingPosition = { x: 0, y: 0, z: 0 };
  ```

#### 常量名
- **规则**: UPPER_SNAKE_CASE
- **示例**:
  ```javascript
  ✅ const MAX_PAINTINGS_PER_WALL = 5;
  ✅ const DEFAULT_LIGHT_INTENSITY = 1.0;
  ✅ const HALL_TYPES = {
    ENTRANCE: 'entrance',
    MAIN: 'main',
    SPECIAL: 'special'
  };
  ❌ const MaxPaintingsPerWall = 5;
  ❌ const default_light_intensity = 1.0;
  ```

#### 函数名
- **规则**: camelCase，动词开头
- **示例**:
  ```javascript
  ✅ function createScene() { }
  ✅ function loadMaterial(materialName) { }
  ✅ function getHallConfig(hallId) { }
  ❌ function CreateScene() { }
  ❌ function scene_create() { }
  ```

#### 类名
- **规则**: PascalCase
- **示例**:
  ```javascript
  ✅ class SceneManager { }
  ✅ class PaintingFrame { }
  ✅ class MaterialLoader { }
  ❌ class sceneManager { }
  ❌ class painting_frame { }
  ```

#### 私有成员
- **规则**: 下划线前缀
- **示例**:
  ```javascript
  ✅ class SceneManager {
    constructor() {
      this._scene = null;
      this._camera = null;
    }
    _initialize() { }
  }
  ```

### 1.3 Three.js对象命名规范

#### Three.js对象
- **规则**: 类型前缀 + camelCase
- **示例**:
  ```javascript
  ✅ const scene = new THREE.Scene();
  ✅ const camera = new THREE.PerspectiveCamera();
  ✅ const renderer = new THREE.WebGLRenderer();
  ✅ const ambientLight = new THREE.AmbientLight();
  ✅ const directionalLight = new THREE.DirectionalLight();
  ✅ const spotLight = new THREE.SpotLight();
  ✅ const paintingMesh = new THREE.Mesh();
  ✅ const wallGeometry = new THREE.BoxGeometry();
  ✅ const floorMaterial = new THREE.MeshStandardMaterial();
  ```

#### Three.js集合
- **规则**: 复数形式
- **示例**:
  ```javascript
  ✅ const paintings = [];
  ✅ const lights = [];
  ✅ const materials = [];
  ```

### 1.4 Vue相关命名规范

#### 组件名
- **规则**: PascalCase
- **示例**:
  ```javascript
  ✅ export default {
    name: 'ThreeDExhibition'
  }
  ```

#### props
- **规则**: camelCase
- **示例**:
  ```javascript
  ✅ props: {
    hallId: {
      type: String,
      required: true
    },
    showIntro: {
      type: Boolean,
      default: false
    }
  }
  ```

#### data
- **规则**: camelCase，返回对象
- **示例**:
  ```javascript
  ✅ data() {
    return {
      currentHall: null,
      isLoading: false,
      paintings: []
    }
  }
  ```

#### methods
- **规则**: camelCase，动词开头
- **示例**:
  ```javascript
  ✅ methods: {
    loadScene() { },
    switchHall(hallId) { },
    handleResize() { }
  }
  ```

#### computed
- **规则**: camelCase，形容词或名词
- **示例**:
  ```javascript
  ✅ computed: {
    currentHallName() { },
    totalPaintings() { },
    isSceneReady() { }
  }
  ```

---

## 二、代码风格规范

### 2.1 缩进和空格

#### 缩进
- **规则**: 使用2个空格，不使用Tab
- **示例**:
  ```javascript
  ✅ function example() {
    if (condition) {
      doSomething();
    }
  }
  ```

#### 空格
- **规则**: 运算符前后加空格
- **示例**:
  ```javascript
  ✅ const sum = a + b;
  ✅ if (a > b) { }
  ✅ function add(a, b) { }
  ```

#### 逗号
- **规则**: 逗号后加空格
- **示例**:
  ```javascript
  ✅ const obj = { a: 1, b: 2, c: 3 };
  ✅ const arr = [1, 2, 3, 4];
  ```

### 2.2 分号

#### 分号使用
- **规则**: 每个语句末尾使用分号
- **示例**:
  ```javascript
  ✅ const a = 1;
  ✅ function foo() { return 1; }
  ❌ const a = 1
  ❌ function foo() { return 1 }
  ```

### 2.3 引号

#### 字符串引号
- **规则**: 优先使用单引号，HTML属性使用双引号
- **示例**:
  ```javascript
  ✅ const name = 'Three.js';
  ✅ const html = '<div class="container">Hello</div>';
  ❌ const name = "Three.js";
  ```

#### 模板字符串
- **规则**: 使用反引号
- **示例**:
  ```javascript
  ✅ const message = `Hello, ${name}!`;
  ❌ const message = 'Hello, ' + name + '!';
  ```

### 2.4 换行

#### 行长度
- **规则**: 每行不超过100个字符
- **示例**:
  ```javascript
  ✅ const result = veryLongFunctionName(
    veryLongParameter1,
    veryLongParameter2,
    veryLongParameter3
  );
  ```

#### 对象和数组
- **规则**: 多行时每个元素单独一行
- **示例**:
  ```javascript
  ✅ const obj = {
    a: 1,
    b: 2,
    c: 3
  };

  ✅ const arr = [
    1,
    2,
    3,
    4
  ];
  ```

### 2.5 函数声明

#### 函数声明
- **规则**: 使用function关键字或箭头函数
- **示例**:
  ```javascript
  ✅ function createScene() {
    // implementation
  }

  ✅ const createScene = () => {
    // implementation
  };
  ```

#### 参数
- **规则**: 参数名要有意义
- **示例**:
  ```javascript
  ✅ function loadPainting(paintingId, position, rotation) { }
  ❌ function loadPainting(id, pos, rot) { }
  ```

#### 返回值
- **规则**: 显式返回
- **示例**:
  ```javascript
  ✅ function getValue() {
    return 1;
  }
  ```

### 2.6 条件语句

#### if语句
- **规则**: 使用花括号
- **示例**:
  ```javascript
  ✅ if (condition) {
    doSomething();
  } else {
    doSomethingElse();
  }
  ❌ if (condition) doSomething();
  ```

#### switch语句
- **规则**: 每个case都要break
- **示例**:
  ```javascript
  ✅ switch (type) {
    case 'entrance':
      handleEntrance();
      break;
    case 'main':
      handleMain();
      break;
    default:
      handleDefault();
  }
  ```

### 2.7 循环语句

#### for循环
- **规则**: 优先使用for...of或for...in
- **示例**:
  ```javascript
  ✅ for (const painting of paintings) {
    // process painting
  }

  ✅ for (const key in object) {
    // process key
  }
  ```

#### 数组方法
- **规则**: 优先使用数组方法
- **示例**:
  ```javascript
  ✅ const filtered = paintings.filter(p => p.visible);
  ✅ const mapped = paintings.map(p => p.id);
  ❌ const filtered = [];
  for (const p of paintings) {
    if (p.visible) filtered.push(p);
  }
  ```

---

## 三、注释规范

### 3.1 文件注释

#### 文件头注释
- **规则**: 每个文件都要有文件头注释
- **示例**:
  ```javascript
  /**
   * 场景管理器
   * 负责管理3D场景的创建、切换和销毁
   *
   * @author 开发SubAgent
   * @created 2026-02-23
   * @version 1.0.0
   */
  ```

### 3.2 类注释

#### 类注释
- **规则**: 每个类都要有类注释
- **示例**:
  ```javascript
  /**
   * 场景管理器类
   * 负责管理3D场景的生命周期
   *
   * @class SceneManager
   * @example
   * const manager = new SceneManager(container);
   * await manager.initialize();
   */
  class SceneManager {
    // implementation
  }
  ```

### 3.3 函数注释

#### JSDoc注释
- **规则**: 使用JSDoc格式
- **示例**:
  ```javascript
  /**
   * 创建一个新的3D场景
   *
   * @param {Object} config - 场景配置对象
   * @param {string} config.hallId - 展厅ID
   * @param {Object} config.camera - 相机配置
   * @param {Object} config.lighting - 灯光配置
   * @returns {THREE.Scene} 创建的场景对象
   * @throws {Error} 当配置无效时抛出错误
   *
   * @example
   * const scene = createScene({
   *   hallId: 'early',
   *   camera: { position: { x: 0, y: 4, z: 10 } },
   *   lighting: { ambient: { intensity: 0.8 } }
   * });
   */
  function createScene(config) {
    // implementation
  }
  ```

### 3.4 变量注释

#### 复杂变量注释
- **规则**: 复杂变量需要注释
- **示例**:
  ```javascript
  ✅ // 展厅空间参数（单位：米）
  const hallDimensions = {
    length: 50,    // 展厅长度
    width: 24,     // 展厅宽度
    height: 10     // 展厅高度
  };

  // 光照衰减系数，用于控制光照强度随距离的衰减
  const lightDecay = 2.0;
  ```

### 3.5 代码块注释

#### 代码块注释
- **规则**: 使用单行注释或多行注释
- **示例**:
  ```javascript
  ✅ // 初始化Three.js场景
  const scene = new THREE.Scene();

  // 初始化相机
  const camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  );

  /**
   * 初始化渲染器
   * 开启抗锯齿和阴影
   */
  const renderer = new THREE.WebGLRenderer({
    antialias: true,
    alpha: true
  });
  renderer.shadowMap.enabled = true;
  ```

### 3.6 TODO注释

#### TODO注释
- **规则**: 使用TODO标记未完成的功能
- **示例**:
  ```javascript
  ✅ // TODO: 实现展厅切换动画
  // TODO: 优化材质加载性能
  // FIXME: 修复展厅切换时的内存泄漏问题
  ```

---

## 四、文件组织规范

### 4.1 目录结构

```
src/
├── api/                    # API接口
│   └── index.js
├── assets/                 # 静态资源
│   ├── images/            # 图片资源
│   ├── models/            # 3D模型
│   └── textures/          # 纹理贴图
├── components/            # Vue组件
│   ├── 3d/               # 3D相关组件
│   │   ├── ThreeDExhibition.vue
│   │   ├── NavigationToolbar.vue
│   │   └── LoadingOverlay.vue
│   ├── common/           # 通用组件
│   │   └── LazyImage.vue
│   └── layout/           # 布局组件
│       ├── HeaderNavbar.vue
│       └── FooterNavbar.vue
├── config/               # 配置文件
│   └── exhibitionHalls.js
├── plugins/              # 插件
│   └── three.js
├── router/               # 路由
│   └── index.js
├── store/                # Vuex状态管理
│   └── index.js
├── stores/               # Pinia状态管理
│   └── exhibitionStore.js
├── three/                # Three.js相关代码
│   ├── scenes/          # 场景类
│   │   ├── SceneManager.js
│   │   ├── HallScene.js
│   │   ├── EntranceHall.js
│   │   ├── EarlyHall.js
│   │   ├── MiddleHall.js
│   │   ├── LateHall.js
│   │   └── ClosingHall.js
│   ├── objects/         # 3D对象类
│   │   ├── PaintingFrame.js
│   │   ├── Wall.js
│   │   ├── Floor.js
│   │   ├── Ceiling.js
│   │   ├── Column.js
│   │   └── InfoPanel.js
│   ├── materials/       # 材质相关
│   │   ├── MaterialManager.js
│   │   ├── WallMaterial.js
│   │   ├── FloorMaterial.js
│   │   └── PaintingMaterial.js
│   ├── lights/          # 灯光相关
│   │   ├── LightManager.js
│   │   ├── AmbientLight.js
│   │   ├── DirectionalLight.js
│   │   └── SpotLight.js
│   ├── utils/           # 工具函数
│   │   ├── geometry.js
│   │   ├── material.js
│   │   └── light.js
│   └── constants.js     # 常量定义
├── utils/                # 通用工具函数
│   ├── format.js
│   └── validation.js
├── views/                # 页面视图
│   ├── HomePage.vue
│   ├── WorkGallery.vue
│   └── ThreeDExhibition.vue
├── App.vue               # 根组件
├── common-styles.css     # 通用样式
└── main.js               # 入口文件
```

### 4.2 文件导入顺序

#### 导入顺序
- **规则**: 1. Node.js内置模块 2. 第三方库 3. 内部模块
- **示例**:
  ```javascript
  ✅ import path from 'path';                    // Node.js内置
  import Vue from 'vue';                        // 第三方库
  import * as THREE from 'three';               // 第三方库
  import SceneManager from './three/scenes/SceneManager.js';  // 内部模块
  import { getHallConfig } from '../config/exhibitionHalls.js'; // 内部模块
  ```

### 4.3 Vue组件结构

#### 组件结构顺序
- **规则**: template -> script -> style
- **示例**:
  ```vue
  <template>
    <!-- 模板内容 -->
  </template>

  <script>
  export default {
    name: 'ComponentName',

    // 组件选项
    components: { },
    props: { },
    data() { },
    computed: { },
    watch: { },
    created() { },
    mounted() { },
    beforeDestroy() { },
    methods: { }
  }
  </script>

  <style scoped>
  /* 样式内容 */
  </style>
  ```

---

## 五、Vue组件开发规范

### 5.1 组件定义

#### 组件命名
- **规则**: 使用PascalCase
- **示例**:
  ```javascript
  ✅ export default {
    name: 'NavigationToolbar'
  }
  ```

#### 组件注册
- **规则**: 优先使用局部注册
- **示例**:
  ```javascript
  ✅ import NavigationToolbar from './components/NavigationToolbar.vue';
  export default {
    components: {
      NavigationToolbar
    }
  }
  ```

### 5.2 Props定义

#### Props类型检查
- **规则**: 必须定义类型
- **示例**:
  ```javascript
  ✅ props: {
    hallId: {
      type: String,
      required: true,
      validator: value => ['entrance', 'early', 'middle', 'late'].includes(value)
    },
    showIntro: {
      type: Boolean,
      default: false
    }
  }
  ```

### 5.3 Data定义

#### Data函数
- **规则**: 必须使用函数返回对象
- **示例**:
  ```javascript
  ✅ data() {
    return {
      currentHall: null,
      isLoading: false,
      paintings: []
    }
  }
  ❌ data: {
    currentHall: null
  }
  ```

### 5.4 生命周期

#### 生命周期使用
- **规则**: 按需使用，合理使用
- **示例**:
  ```javascript
  ✅ created() {
    // 数据初始化
    this.loadConfig();
  },
  mounted() {
    // DOM操作、事件监听
    this.initScene();
    window.addEventListener('resize', this.handleResize);
  },
  beforeDestroy() {
    // 清理工作
    this.destroyScene();
    window.removeEventListener('resize', this.handleResize);
  }
  ```

### 5.5 方法定义

#### 方法命名
- **规则**: 动词开头，camelCase
- **示例**:
  ```javascript
  ✅ methods: {
    loadScene() { },
    switchHall(hallId) { },
    handlePaintingClick(painting) { }
  }
  ```

#### 事件处理
- **规则**: 事件处理函数以handle开头
- **示例**:
  ```javascript
  ✅ methods: {
    handleClick() { },
    handleMouseEnter() { },
    handleMouseLeave() { }
  }
  ```

---

## 六、Three.js开发规范

### 6.1 场景初始化

#### 场景创建
- **规则**: 创建专门的场景管理器
- **示例**:
  ```javascript
  ✅ class SceneManager {
    constructor(container) {
      this.container = container;
      this.scene = null;
      this.camera = null;
      this.renderer = null;
    }

    async initialize() {
      // 创建场景
      this.scene = new THREE.Scene();

      // 创建相机
      this.camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );

      // 创建渲染器
      this.renderer = new THREE.WebGLRenderer({
        antialias: true,
        alpha: true
      });
      this.renderer.setSize(window.innerWidth, window.innerHeight);
      this.container.appendChild(this.renderer.domElement);
    }
  }
  ```

### 6.2 资源管理

#### 资源加载
- **规则**: 使用LoadingManager管理加载进度
- **示例**:
  ```javascript
  ✅ const loadingManager = new THREE.LoadingManager();
  loadingManager.onProgress = (url, loaded, total) => {
    const progress = (loaded / total) * 100;
    console.log(`Loading: ${progress}%`);
  };

  const textureLoader = new THREE.TextureLoader(loadingManager);
  ```

#### 资源释放
- **规则**: 及时释放不需要的资源
- **示例**:
  ```javascript
  ✅ destroy() {
    // 释放几何体
    this.mesh.geometry.dispose();

    // 释放材质
    this.mesh.material.dispose();

    // 释放纹理
    if (this.mesh.material.map) {
      this.mesh.material.map.dispose();
    }

    // 从场景中移除
    this.scene.remove(this.mesh);
  }
  ```

### 6.3 材质使用

#### 材质复用
- **规则**: 相同材质应该复用
- **示例**:
  ```javascript
  ✅ // 创建一次，多次使用
  const wallMaterial = new THREE.MeshStandardMaterial({
    color: 0xFFFAF0,
    roughness: 0.5,
    metalness: 0.1
  });

  const walls = [
    createWall({ material: wallMaterial }),
    createWall({ material: wallMaterial }),
    createWall({ material: wallMaterial })
  ];
  ```

#### 材质优化
- **规则**: 优化材质属性
- **示例**:
  ```javascript
  ✅ // 只在需要时开启某些特性
  const material = new THREE.MeshStandardMaterial({
    color: 0xFFFAF0,
    roughness: 0.5,
    metalness: 0.1,
    flatShading: false,  // 默认false，需要时才开启
    transparent: false,  // 默认false，需要时才开启
    side: THREE.FrontSide  // 默认只渲染正面
  });
  ```

### 6.4 灯光使用

#### 灯光数量
- **规则**: 控制灯光数量，避免过多
- **示例**:
  ```javascript
  ✅ // 1个环境光 + 2-3个主光源 + 若干聚光灯
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
  const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
  const spotLights = paintings.map(p => createSpotLight(p.position));
  ```

#### 阴影优化
- **规则**: 优化阴影设置
- **示例**:
  ```javascript
  ✅ // 只对关键物体开启阴影
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;

  // 聚光灯开启阴影
  const spotLight = new THREE.SpotLight(0xffffff, 1);
  spotLight.castShadow = true;
  spotLight.shadow.mapSize.width = 1024;  // 降低分辨率
  spotLight.shadow.mapSize.height = 1024;
  spotLight.shadow.bias = -0.0001;  // 减少阴影伪影
  ```

### 6.5 性能优化

#### 渲染循环
- **规则**: 优化渲染循环
- **示例**:
  ```javascript
  ✅ let lastTime = 0;
  const targetFPS = 60;
  const frameInterval = 1000 / targetFPS;

  function animate(time) {
    requestAnimationFrame(animate);

    const elapsed = time - lastTime;

    // 控制帧率
    if (elapsed > frameInterval) {
      lastTime = time - (elapsed % frameInterval);
      renderer.render(scene, camera);
    }
  }
  ```

#### 视锥体剔除
- **规则**: 启用视锥体剔除
- **示例**:
  ```javascript
  ✅ renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  ```

---

## 七、Git提交规范

### 7.1 提交信息格式

#### Commit Message格式
- **规则**: type(scope): subject
- **示例**:
  ```
  ✅ feat(three): 添加早期展厅场景
  ✅ fix(ui): 修复导航栏显示问题
  ✅ refactor(scene): 优化场景切换逻辑
  ✅ docs(readme): 更新项目文档
  ✅ style(css): 统一按钮样式
  ✅ test(scene): 添加场景管理器测试
  ✅ chore(deps): 更新Three.js版本
  ```

#### Type类型
- **feat**: 新功能
- **fix**: Bug修复
- **docs**: 文档更新
- **style**: 代码格式调整
- **refactor**: 重构
- **test**: 测试相关
- **chore**: 构建/工具链相关

### 7.2 分支管理

#### 分支命名
- **规则**: feature/功能名、fix/问题名、hotfix/紧急修复
- **示例**:
  ```
  ✅ feature/early-hall-scene
  ✅ fix/navigation-bug
  ✅ hotfix/critical-memory-leak
  ```

#### 分支策略
- **main**: 主分支，用于生产环境
- **develop**: 开发分支，用于日常开发
- **feature/***: 功能分支
- **fix/***: 修复分支
- **hotfix/***: 紧急修复分支

---

## 八、错误处理规范

### 8.1 错误捕获

#### Try-Catch使用
- **规则**: 异步操作和关键操作使用try-catch
- **示例**:
  ```javascript
  ✅ async function loadScene(sceneId) {
    try {
      const config = await fetchSceneConfig(sceneId);
      const scene = createScene(config);
      return scene;
    } catch (error) {
      console.error('Failed to load scene:', error);
      throw new Error(`Scene loading failed: ${error.message}`);
    }
  }
  ```

### 8.2 错误日志

#### 错误日志
- **规则**: 记录详细的错误信息
- **示例**:
  ```javascript
  ✅ try {
    // some code
  } catch (error) {
    console.error('Error in loadScene:', {
      message: error.message,
      stack: error.stack,
      sceneId,
      timestamp: new Date().toISOString()
    });
  }
  ```

### 8.3 用户提示

#### 错误提示
- **规则**: 给用户友好的错误提示
- **示例**:
  ```javascript
  ✅ catch (error) {
    showUserMessage('展厅加载失败，请刷新页面重试');
    console.error('Detailed error:', error);
  }
  ```

---

## 九、性能规范

### 9.1 内存管理

#### 资源释放
- **规则**: 及时释放不再使用的资源
- **示例**:
  ```javascript
  ✅ beforeDestroy() {
    // 释放Three.js资源
    if (this.scene) {
      this.scene.traverse((object) => {
        if (object.geometry) object.geometry.dispose();
        if (object.material) {
          if (Array.isArray(object.material)) {
            object.material.forEach(m => m.dispose());
          } else {
            object.material.dispose();
          }
        }
      });
    }
  }
  ```

### 9.2 渲染优化

#### 按需渲染
- **规则**: 只在需要时渲染
- **示例**:
  ```javascript
  ✅ let needsRender = true;

  function onObjectChange() {
    needsRender = true;
  }

  function animate() {
    requestAnimationFrame(animate);
    if (needsRender) {
      renderer.render(scene, camera);
      needsRender = false;
    }
  }
  ```

### 9.3 加载优化

#### 懒加载
- **规则**: 按需加载资源
- **示例**:
  ```javascript
  ✅ async function switchHall(hallId) {
    // 释放当前展厅资源
    unloadHall(currentHallId);

    // 加载新展厅
    await loadHall(hallId);
  }
  ```

---

## 十、测试规范

### 10.1 单元测试

#### 测试文件
- **规则**: 测试文件与源文件同名
- **示例**:
  ```
  ✅ sceneManager.js -> sceneManager.spec.js
  ✅ paintingFrame.js -> paintingFrame.spec.js
  ```

#### 测试命名
- **规则**: 描述性命名
- **示例**:
  ```javascript
  ✅ describe('SceneManager', () => {
    it('should create scene successfully', () => { });
    it('should switch hall correctly', () => { });
    it('should throw error when config is invalid', () => { });
  });
  ```

### 10.2 集成测试

#### 测试场景
- **规则**: 测试完整的使用场景
- **示例**:
  ```javascript
  ✅ describe('Exhibition Integration', () => {
    it('should complete full exhibition tour', async () => {
      await enterEntrance();
      await switchToEarlyHall();
      await switchToMiddleHall();
      await switchToLateHall();
      await exitExhibition();
    });
  });
  ```

---

## 十一、UI组件和可访问性规范

### 11.1 UI设计规范遵循

**重要**: 所有UI组件必须严格遵循 `UI设计规范.md` 中的设计标准。

#### 11.1.1 色彩使用
- **主色**: 金色 #ffd700（标题、强调元素）
- **辅助色**: 深褐色 #3d2817（主要背景）
- **背景色**: 浅灰色 #f5f5f5（页面背景）
- **文字色**: 深灰色 #333（正文文字）
- **状态色**: 成功#28a745、警告#ffc107、错误#dc3545、信息#17a2b8

#### 11.1.2 字体使用
- **H1**: 36px, 粗体, 用于页面主标题
- **H2**: 28px, 粗体, 用于章节标题
- **H3**: 22px, 粗体, 用于子章节标题
- **H4**: 18px, 粗体, 用于区块标题
- **Body**: 16px, 常规, 用于正文
- **Small**: 14px, 常规, 用于辅助文字
- **Caption**: 12px, 常规, 用于说明文字

#### 11.1.3 间距使用
- **xs**: 4px, 极小间距
- **sm**: 8px, 小间距
- **md**: 16px, 中等间距
- **lg**: 24px, 大间距
- **xl**: 32px, 超大间距
- **xxl**: 48px, 巨大间距

#### 11.1.4 圆角使用
- **xs**: 2px, 小圆角
- **sm**: 4px, 中小圆角
- **md`: 8px, 中等圆角
- **lg**: 12px, 大圆角
- **xl**: 16px, 超大圆角

#### 11.1.5 阴影使用
- **shadow-sm**: 轻微阴影（卡片悬停）
- **shadow-md**: 中等阴影（模态框）
- **shadow-lg**: 较强阴影（弹出菜单）
- **shadow-xl**: 强阴影（对话框）

### 11.2 可访问性规范（Accessibility）

**重要**: 所有交互组件必须满足 WCAG 2.1 AA 级可访问性标准。

#### 11.2.1 键盘导航
- **Tab导航**: 所有可交互元素必须可通过Tab键访问
- **焦点指示**: 聚焦元素必须有明显的视觉反馈（边框、背景色变化）
- **快捷键**: 提供常用功能的快捷键（ESC关闭、Enter确认）
- **焦点陷阱**: 模态框打开时，焦点必须限制在模态框内

**示例**:
```vue
<template>
  <button
    @click="handleClick"
    @keydown.enter="handleClick"
    @keydown.space="handleClick"
    :class="{ 'focused': isFocused }"
    tabindex="0"
    aria-label="查看详情"
  >
    点击查看
  </button>
</template>

<style scoped>
.focused {
  outline: 2px solid #ffd700;
  outline-offset: 2px;
}
</style>
```

#### 11.2.2 ARIA标签
- **aria-label**: 为没有文本的元素提供描述
- **aria-describedby**: 关联描述性文本
- **aria-expanded**: 标识可展开/折叠状态
- **aria-hidden**: 隐藏装饰性元素
- **role**: 明确元素角色（button、navigation、dialog等）

**示例**:
```vue
<template>
  <button
    @click="toggleMenu"
    aria-label="打开菜单"
    aria-expanded="isMenuOpen"
    aria-controls="main-menu"
  >
    <svg aria-hidden="true">...</svg>
    <span class="sr-only">菜单</span>
  </button>
  
  <nav id="main-menu" role="navigation" aria-label="主导航">
    <ul>
      <li><a href="#hall1" aria-current="page">序厅</a></li>
      <li><a href="#hall2">早期展厅</a></li>
    </ul>
  </nav>
</template>
```

#### 11.2.3 颜色对比度
- **文字对比度**: 正文文字与背景对比度至少 4.5:1
- **大文字对比度**: 大文字（18px+）与背景对比度至少 3:1
- **组件对比度**: UI组件与背景对比度至少 3:1
- **焦点指示**: 焦点指示器与背景对比度至少 3:1

#### 11.2.4 屏幕阅读器支持
- **语义化HTML**: 使用正确的HTML标签（nav、main、section等）
- **alt文本**: 所有图片必须有描述性的alt文本
- **表单标签**: 所有表单元素必须有label
- **实时更新**: 动态内容更新时使用aria-live

**示例**:
```vue
<template>
  <img
    src="/images/painting.jpg"
    alt="黄宾虹山水画作品，创作于1948年"
  />
  
  <label for="hall-select">选择展厅:</label>
  <select id="hall-select">
    <option value="hall1">序厅</option>
    <option value="hall2">早期展厅</option>
  </select>
  
  <div aria-live="polite" aria-atomic="true">
    {{ statusMessage }}
  </div>
</template>
```

#### 11.2.5 动画和过渡
- **可禁用**: 提供选项禁用动画（respect prefers-reduced-motion）
- **持续时间**: 动画持续时间不超过 200ms
- **不闪烁**: 避免闪烁内容（3次/秒以上）
- **可暂停**: 自动播放内容必须可暂停

**示例**:
```vue
<template>
  <div
    class="fade-animation"
    :class="{ 'no-animation': prefersReducedMotion }"
  >
    内容
  </div>
</template>

<script>
export default {
  data() {
    return {
      prefersReducedMotion: window.matchMedia('(prefers-reduced-motion: reduce)').matches
    }
  }
}
</script>

<style scoped>
.fade-animation {
  transition: opacity 0.2s ease-in-out;
}

.no-animation {
  transition: none;
}
</style>
```

### 11.3 加载体验规范

#### 11.3.1 加载指示
- **进度条**: 显示加载进度百分比
- **加载动画**: 使用优雅的加载动画
- **骨架屏**: 内容加载前显示骨架屏
- **加载超时**: 10秒后显示加载超时提示

#### 11.3.2 渐进式加载
- **优先级加载**: 关键内容优先加载
- **懒加载**: 非关键内容延迟加载
- **预加载**: 预测用户行为，预加载可能需要的内容
- **分批加载**: 大量数据分批加载

**示例**:
```vue
<template>
  <div>
    <!-- 骨架屏 -->
    <div v-if="isLoading" class="skeleton">
      <div class="skeleton-title"></div>
      <div class="skeleton-content"></div>
    </div>
    
    <!-- 实际内容 -->
    <div v-else>
      <h1>{{ title }}</h1>
      <p>{{ content }}</p>
    </div>
    
    <!-- 加载进度 -->
    <div v-if="isProgressLoading" class="progress-bar">
      <div class="progress" :style="{ width: progress + '%' }"></div>
      <span>{{ progress }}%</span>
    </div>
  </div>
</template>
```

### 11.4 交互反馈规范

#### 11.4.1 悬停状态
- **视觉反馈**: 鼠标悬停时显示视觉反馈（颜色变化、阴影增强）
- **光标变化**: 可交互元素显示适当的光标（pointer、move、grab）
- **延迟响应**: 避免过于敏感的悬停响应（建议100-200ms延迟）

#### 11.4.2 点击状态
- **即时反馈**: 点击后立即显示反馈（按钮按下效果、加载状态）
- **禁用状态**: 操作完成后临时禁用按钮，防止重复提交
- **成功反馈**: 操作成功后显示成功提示

#### 11.4.3 禁用状态
- **视觉区分**: 禁用元素与正常元素有明显视觉区分（降低不透明度、灰色调）
- **不可交互**: 禁用元素不响应任何交互
- **原因说明**: 鼠标悬停时显示禁用原因

**示例**:
```vue
<template>
  <button
    @click="handleSave"
    :disabled="isSaving || !isValid"
    :class="buttonClass"
    :title="buttonTitle"
  >
    <span v-if="isSaving">保存中...</span>
    <span v-else>保存</span>
  </button>
</template>

<script>
export default {
  computed: {
    buttonClass() {
      return {
        'disabled': this.isSaving || !this.isValid,
        'loading': this.isSaving
      }
    },
    buttonTitle() {
      if (this.isSaving) return '正在保存...'
      if (!this.isValid) return '请先完成必填项'
      return '保存更改'
    }
  }
}
</script>

<style scoped>
.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.loading {
  cursor: wait;
}
</style>
```

### 11.5 响应式设计规范

#### 11.5.1 断点定义
- **移动端**: < 768px
- **平板**: 768px - 1024px
- **桌面**: > 1024px

#### 11.5.2 响应式实现
- **弹性布局**: 使用Flexbox和Grid布局
- **相对单位**: 使用rem、em、%等相对单位
- **媒体查询**: 使用媒体查询适配不同设备
- **移动优先**: 优先实现移动端布局，再适配桌面端

**示例**:
```vue
<style scoped>
.container {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
}

@media (min-width: 768px) {
  .container {
    grid-template-columns: 1fr 1fr;
  }
}

@media (min-width: 1024px) {
  .container {
    grid-template-columns: 1fr 1fr 1fr;
    gap: 24px;
  }
}
</style>
```

---

## 十二、文档规范

### 11.1 README文档

#### 项目README
- **规则**: 包含完整的项目信息
- **结构**:
  ```
  # 项目名称
  - 项目简介
  - 技术栈
  - 快速开始
  - 项目结构
  - 开发指南
  - 部署说明
  - 贡献指南
  - 许可证
  ```

### 11.2 代码文档

#### 函数文档
- **规则**: 使用JSDoc
- **示例**:
  ```javascript
  /**
   * 加载指定的展厅
   *
   * @param {string} hallId - 展厅ID
   * @returns {Promise<Object>} 展厅配置对象
   * @throws {Error} 当展厅不存在时抛出错误
   *
   * @example
   * const hall = await loadHall('early');
   */
  async function loadHall(hallId) {
    // implementation
  }
  ```

---

## 十三、总结

本代码规范涵盖了黄宾虹数字艺术展3D展厅项目的所有开发规范，包括命名规范、代码风格、注释规范、文件组织、Vue组件开发、Three.js开发、Git提交、错误处理、性能优化、测试、文档、UI组件和可访问性等方面的详细规定。

严格遵循本规范可以提高代码质量、降低维护成本、提升团队协作效率，确保项目能够按时、高质量交付。

---

## 版本历史

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|---------|--------|
| v1.1 | 2026-02-23 | 添加UI组件和可访问性规范章节 | 开发SubAgent |
| v1.0 | 2026-02-23 | 初始版本创建 | 开发SubAgent |

本代码规范文档详细规定了黄宾虹数字艺术展3D展厅项目的代码编写规范，包括命名规范、代码风格、注释规范、文件组织、Vue组件开发、Three.js开发、Git提交、错误处理、性能优化、测试和文档等方面。

所有开发人员必须严格遵守本规范，确保代码质量和项目可维护性。如有疑问或建议，请及时提出，共同完善规范。

---

**附录：参考资源**
- Vue.js官方文档: https://vuejs.org/
- Three.js官方文档: https://threejs.org/
- JavaScript标准风格: https://standardjs.com/
- Airbnb JavaScript风格指南: https://github.com/airbnb/javascript